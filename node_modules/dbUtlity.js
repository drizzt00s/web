module.exports.recurQuery = function (dataArray,table,targetColumn,res,queryType){
    if(!dataArray instanceof Array){
        throw new Error("dataArray must be an array");
    }
    if(typeof(table)!='string'){
        throw new Error("dataArray must be a string");
    }
    var recurIndex=0;
    var client=utility.prepareDb();
    var storeQueryResult=[];
    recurQueryDetail(dataArray,table,targetColumn,res);
    function recurQueryDetail(dataArray,table,targetColumn,res){
        if(recurIndex===dataArray.length){
        res.send(storeQueryResult);
            return false;
        }
        var queryString="select * from "+table+" where "+targetColumn+"='"+dataArray[recurIndex]+"'";
        client.query(queryString,function(e,r){
            if(e){
                throw e;
            }
            storeQueryResult.push(r);
            recurIndex++;
            recurQueryDetail(dataArray,table,targetColumn,res);
        });
    }
};

module.exports.createQueryString = function (dataArray,columnArray,queryType,tableName){
    if(arguments.length!==4){
        throw new Error("arguments'length must be four");
    }
    if(!dataArray instanceof Array||!columnArray instanceof Array){
        throw new Error("Two arguments must be Array");
    }
    if(typeof queryType!=="number"){
        throw new Error("queryType must be a number");
    }
    if(typeof tableName!=="string"){
        throw new Error("tableName must be a string");
    }
    var queryString="";
    if(queryType===1){
        //insert
        queryString="insert into "+tableName+"(";
        for(var i=0;i<columnArray.length;i++){
            if(i===(columnArray.length-1)){
                queryString+=(columnArray[i]+")");
                break;
            }
            queryString+=(columnArray[i]+",");
        }
        queryString=queryString+" values(";
        for(var j=0;j<dataArray.length;j++){
            if(j===(dataArray.length-1)){
                queryString+=("'"+dataArray[j]+"'"+")");
                break;
            }
            queryString+=("'"+dataArray[j]+"'" +",");
        }
        return queryString;
    }
    else if(queryType===2){
        //select
        queryString="select * from "+tableName+" where ";
        if(columnArray.length===1){
            queryString="select * from "+tableName+" where "+columnArray[0]+"="+"'"+dataArray+"'";
            return queryString;
        } else {
                for(var i=0;i<columnArray.length;i++){
                    if(i===(columnArray.length-1)){
                        queryString+=(columnArray[i]+"='"+dataArray[i]+"'");
                        break;
                    }
                    queryString+=(columnArray[i]+"='"+dataArray[i]+"'"+" and ");
                }
                return queryString;
        }
    }
    else if(queryType==3){
        //update
        var queryString="update "+tableName+" set ";
        for(var i=0;i<columnArray.length;i++){
            if(i===(columnArray.length-2)){
                queryString+=(columnArray[i]+"='"+dataArray[i]+"'");
                continue;
            }
            if(i===(columnArray.length-1)){
                queryString+=(" where username='"+dataArray[i]+"'");
                break;
            }
            queryString+=(columnArray[i]+"='"+dataArray[i]+"'"+",");
        }
        return queryString;
    }
};
